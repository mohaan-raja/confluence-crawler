<h1>Title: ES queries</h1><ul><li>ES1: Exact name match</li></ul><p>def base_get_es_query(lead_name):<br/> '''<br/> Base query. Matches exact names.<br/> '''<br/> query_curr = '''<br/> {<br/> &quot;query&quot;: {<br/> &quot;filtered&quot;: {<br/> &quot;filter&quot;: {<br/> &quot;bool&quot;: {<br/> &quot;must&quot;: [<br/> {<br/> &quot;bool&quot;: {<br/> &quot;should&quot;: [<br/> {<br/> &quot;query&quot;: {<br/> &quot;match&quot;: {<br/> &quot;name.not_analyzed&quot;: &quot;%s&quot;<br/> }<br/> }<br/> },<br/> {<br/> &quot;query&quot;: {<br/> &quot;multi_match&quot;: {<br/> &quot;query&quot;: &quot;shahee@<a href="http://gmail.com" class="external-link" rel="nofollow">gmail.com</a>&quot;,<br/> &quot;fields&quot;: [<br/> &quot;emails.not_analyzed&quot;<br/> ]<br/> }<br/> }<br/> }<br/> ]<br/> }<br/> }<br/> ],<br/> &quot;must_not&quot;: [<br/> {<br/> &quot;query&quot;: {<br/> &quot;match&quot;: {<br/> &quot;id&quot;: &quot;9&quot;<br/> }<br/> }<br/> }<br/> ]<br/> }<br/> }<br/> }<br/> },<br/> &quot;sort&quot;: [<br/> {<br/> &quot;last_contacted&quot;: {<br/> &quot;order&quot;: &quot;desc&quot;<br/> }<br/> }<br/> ],<br/> &quot;_source&quot;: [<br/> &quot;id&quot;, &quot;lead_id&quot;<br/> ],<br/> &quot;size&quot;: 25,<br/> &quot;from&quot;: 0 <br/>}<br/>''' % (lead_name)<br/> return query_curr</p><p><br/></p><p><br/></p><p><br/></p><ul><li>ES2: Name match and company_name match lastname</li></ul><p>def get_es_query(primary_rec):<br/> '''<br/> Build ES query<br/> '''<br/> query_curr = '''<br/> {<br/> &quot;query&quot;: {<br/> &quot;filtered&quot;: {<br/> &quot;filter&quot;: {<br/> &quot;bool&quot;: {<br/> &quot;must&quot;: [<br/> {<br/> &quot;bool&quot;: {<br/> &quot;should&quot;: [<br/> {<br/> &quot;query&quot;: {<br/> &quot;match&quot;: {<br/> &quot;name.not_analyzed&quot;: &quot;%s&quot;<br/> }<br/> }<br/> },<br/> {<br/> &quot;query&quot;: {<br/> &quot;match&quot;: {<br/> &quot;company_name.not_analyzed&quot;: &quot;%s&quot;<br/> }<br/> }<br/> }<br/> ]<br/> }<br/> }<br/> ],<br/> &quot;must_not&quot;: [<br/> {<br/> &quot;query&quot;: {<br/> &quot;match&quot;: {<br/> &quot;id&quot;: &quot;9&quot;<br/> }<br/> }<br/> }<br/> ]<br/> }<br/> }<br/> }<br/> },<br/> &quot;sort&quot;: [<br/> {<br/> &quot;last_contacted&quot;: {<br/> &quot;order&quot;: &quot;desc&quot;<br/> }<br/> }<br/> ],<br/> &quot;_source&quot;: [<br/> &quot;id&quot;, &quot;lead_id&quot;<br/> ],<br/> &quot;size&quot;: 25,<br/> &quot;from&quot;: 0 <br/>}<br/>''' % (primary_rec['name'], primary_rec['last_name'])<br/> return query_curr</p><p><br/></p><ul><li>ES3</li></ul><p class="p1"><span class="s1">{</span></p><p class="p1"><span class="s1">  &quot;query&quot;: {</span></p><p class="p1"><span class="s1">    &quot;filtered&quot;: {</span></p><p class="p1"><span class="s1">      &quot;query&quot;: {</span></p><p class="p1"><span class="s1">        &quot;bool&quot;: {</span></p><p class="p1"><span class="s1">          &quot;should&quot;: [</span></p><p class="p1"><span class="s1">            {</span></p><p class="p1"><span class="s1">              &quot;match&quot;: {</span></p><p class="p1"><span class="s1">                &quot;name&quot;: {</span></p><p class="p1"><span class="s1">                  &quot;query&quot;: &quot;%s&quot;,</span></p><p class="p1"><span class="s1">                  &quot;boost&quot;: 1</span></p><p class="p2"><span class="s1"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>  </span></p><p class="p1"><span class="s1">                }</span></p><p class="p1"><span class="s1">              }</span></p><p class="p1"><span class="s1">            },</span></p><p class="p1"><span class="s1">            {</span></p><p class="p1"><span class="s1">              &quot;match&quot;: {</span></p><p class="p1"><span class="s1">                &quot;company_name.not_analyzed&quot;: {</span></p><p class="p1"><span class="s1">                  &quot;query&quot;: &quot;%s&quot;,</span></p><p class="p1"><span class="s1">                  &quot;boost&quot;: 1.5</span></p><p class="p1"><span class="s1">                }</span></p><p class="p1"><span class="s1">              }</span></p><p class="p1"><span class="s1">            },</span></p><p class="p1"><span class="s1">            {</span></p><p class="p1"><span class="s1">              &quot;match&quot;: {</span></p><p class="p1"><span class="s1">                &quot;company_name.not_analyzed&quot;: {</span></p><p class="p1"><span class="s1">                  &quot;query&quot;: &quot;%s&quot;,</span></p><p class="p1"><span class="s1">                  &quot;boost&quot;: 1</span></p><p class="p1"><span class="s1">                }</span></p><p class="p1"><span class="s1">              }</span></p><p class="p1"><span class="s1">            },</span></p><p class="p1"><span class="s1">            {</span></p><p class="p1"><span class="s1">              &quot;match&quot;: {</span></p><p class="p1"><span class="s1">                &quot;work_number.not_analyzed&quot;: {</span></p><p class="p1"><span class="s1">                  &quot;query&quot;: &quot;%s&quot;,</span></p><p class="p1"><span class="s1">                  &quot;boost&quot;: 2 </span></p><p class="p1"><span class="s1">                }</span></p><p class="p1"><span class="s1">              }</span></p><p class="p1"><span class="s1">            },</span></p><p class="p1"><span class="s1">            {</span></p><p class="p1"><span class="s1">              &quot;match&quot;: {</span></p><p class="p1"><span class="s1">                &quot;mobile_number.not_analyzed&quot;: {</span></p><p class="p1"><span class="s1">                  &quot;query&quot;: &quot;%s&quot;,</span></p><p class="p1"><span class="s1">                  &quot;boost&quot;: 2</span></p><p class="p1"><span class="s1">                }</span></p><p class="p1"><span class="s1">              }</span></p><p class="p1"><span class="s1">            }</span></p><p class="p1"><span class="s1">          ]</span></p><p class="p1"><span class="s1">        }</span></p><p class="p1"><span class="s1">      },</span></p><p class="p1"><span class="s1">      &quot;filter&quot;: {</span></p><p class="p1"><span class="s1">        &quot;bool&quot;: {</span></p><p class="p1"><span class="s1">          &quot;must&quot;: {</span></p><p class="p1"><span class="s1">            &quot;term&quot;: {</span></p><p class="p1"><span class="s1">              &quot;account_id&quot;: &quot;%s&quot;</span></p><p class="p1"><span class="s1">            }</span></p><p class="p1"><span class="s1">          }</span></p><p class="p1"><span class="s1">        }</span></p><p class="p1"><span class="s1">      }</span></p><p class="p1"><span class="s1">    }</span></p><p class="p1"><span class="s1">  },</span></p><p class="p1"><span class="s1">  &quot;size&quot;: 4 </span></p><p class="p1">}}</p><p class="p1"><br/></p><p><br/></p>