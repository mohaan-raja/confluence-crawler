<h1>Title: Central Consumer</h1><p>Central Kafka Consumer Implementation-</p><p>Every topic in Kafka has multiple partitions to enable parallel processing. We have created a consumer group that has more than one consumer process, and each consumer process traverses from one partition only. the number of consumers in a consumer group &lt;= number of partitions in a topic. Every consumer group must have a unique name because it will commit it's metadata i.e the last read offset in the kafka-store with that unique identifier. The consumer will periodically commit (offset_commit_interval: 10 seconds) the last processed offset in the kafka-store to start processing from in case of failures and consumer crashes or restart. </p><p>All configurations are kept constants: topics, group_id and the same can be extended to consume any topic from central. Generic class CentralConsumer::Runner which can run any consumer client from any Kafka cluster. By Default, all consumers mentioned in the constants will be started. If no options are provided configurations will be taken from the default. The only param that can be overridden is the number of consumers to spawn, from the command line.</p><p><br/>Command -</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: ruby; gutter: false; theme: Confluence" data-theme="Confluence">rails runner lib/central_consumer/runner.rb


rails runner lib/central_consumer/runner.rb --consumer &quot;freshmarketer-activities&quot;</pre>
</div></div><p>Options - </p><p>--consumer = Name of consumer </p><p>--n = Number of consumer processes to spawn</p><p>Ex<strong>  - Number of Partitions</strong><span> </span>in the topic central-freshmarketer-fsales-activities-topic is<span> </span><strong>3</strong>, so spawning that many numbers of consumers.</p><p><br/></p><p><strong>How to handle errors while processing?</strong></p><p>The consumer is loosely coupled with the processors, such that errors while processing or other issues can be mitigated gracefully. After n number of retries (threshold = 3) we will push the failed messages as it is to a separate central topic - <span style="color: rgb(34,34,34);">&quot;freshsales-failed-messages&quot;, which will hold all the errored messages so that we don't lose any data. Messages from this topic can be consumed after we fix the issues on our side. We will be using the central producer API rather than the central-publisher gem, to post messages using an API call.</span></p><p><br/></p><p>Important Links-</p><p>More on kafka - <a href="https://kafka.apache.org/intro" class="external-link" rel="nofollow">https://kafka.apache.org/intro</a></p><p>Complete info on central kafka - <a href="https://confluence.freshworks.com/display/PLAT/Central+Details#CentralDetails-Burrow-Consumerlagmonitoringtool" rel="nofollow">https://confluence.freshworks.com/display/PLAT/Central+Details</a></p><p>Monitor consumers and topic - <a href="https://central-tools-staging.freshworksapi.com/v3/kafka/central/consumer" style="text-decoration: none;text-align: left;" rel="nofollow" class="external-link">https://central-tools-staging.freshworksapi.com/v3/kafka/central/consumer</a></p><p>Another framework that can also be used- <a href="https://github.com/zendesk/racecar" class="external-link" rel="nofollow">https://github.com/zendesk/racecar</a></p><p>Central Kafka has moved from apache kafka cluster to confluent-kafka which is built on top of the former. But confluent doesn't provide any library for ruby. Since confluent-kafka doesn't provide any library for ruby, ruby-Kafka is used. So there are options and configurations that confluent-kafka has, but ruby-kafka doesn't support it.</p><p><br/></p><p><br/></p>