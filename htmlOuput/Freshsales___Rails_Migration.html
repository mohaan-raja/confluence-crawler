<h1>Title: Freshsales - Rails Migration</h1><h3 id="FreshsalesRailsMigration-CurrentVersion">Current Version</h3><p>Ruby version: ruby 2.3.7p456</p><p>Rails version: 3.2.22</p><p><span>Our current rails version is so old(3.2.2) and outdated there were no security patches and updates, and we are missing many updated and efficient ways to do things. Current rails stable version is 6.0.0. We are selecting 5.2 as destination version since 6.0.0 is new and many gems need to be adopted and we cannot risk security in the new upgrade. 5.2 has not reached EOL yet. Hence it is safe to upgrade</span></p><h3 id="FreshsalesRailsMigration-WhyupgradeRails?">Why upgrade Rails?</h3><ul><li><span>EOL has removed all versions before 5.2.x</span></li><li><span>No bug or security patches before 5.2.x</span></li><li><span>Already Gems like paperclip patched for security issues</span></li><li><span>More delay in the upgrade, more effort due to deprecations and unsupported APIs/functionalities</span></li><li><span>As the code base grows, the periodic upgrade is avoided major overhaul and efforts</span></li><li><span>Many methods and utils that we needed were provided in the recent versions</span></li></ul><h3 id="FreshsalesRailsMigration-Goal">Goal</h3><ul><li><span>Upgrade the rails and our codebase to 5.2.*</span></li><li><span>Upgrade all necessary gems(All gems needs updation) and remove unused ones(Paperclip, Redis...)(Need to do in all versions)</span></li><li><span>Internal gems(like multitenant, subscription...) gems need to be updated by our internal team.  (Need to do in all versions)</span></li><li><span>Config changes in the code(Few were mandated by rails)</span></li><li><span>Serialising and store in cache/external storage should be removed since this will cause the problem in rails and also it is unnecessary.</span></li></ul><p><br/></p><h3 id="FreshsalesRailsMigration-Q4plan">Q4 plan</h3><ul><li>Move rails from 3.22 to 4.0 in Q4. </li><li>Freshsales should run in 3.22 and 4.0 for some time until we move to 4.0 completely.</li><li>Need to build capabilities to run our app in two different versions(Dual boot approach)</li><li>Test and automation should run for both versions.</li></ul><h3 id="FreshsalesRailsMigration-Q4Progress">Q4 Progress</h3><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 75.8824%;"><colgroup><col style="width: 16.6828%;"/><col style="width: 39.0883%;"/><col style="width: 44.2289%;"/></colgroup><tbody><tr><th class="confluenceTh"><br/></th><th class="confluenceTh"><p><br/></p><p>Planned</p></th><th colspan="1" class="confluenceTh"><p><br/></p><p>Actual</p></th></tr><tr><td colspan="1" class="confluenceTd"><strong>Week 1<br/>(11-Nov- 15-nov)</strong></td><td colspan="1" class="confluenceTd"><p>Move to 4.0.13 and keep build running</p><p>Move gems</p><p>Find all-important breakage changes</p><p><br/></p></td><td colspan="1" class="confluenceTd"><p>Moved to 4.0.13</p><p>Almost all gems were moved</p><p>Major changes have been found out still minor things need to be found out.</p></td></tr><tr><td colspan="1" class="confluenceTd"><strong>Week 2<br/>(18-Nov - 22-Nov)</strong></td><td colspan="1" class="confluenceTd"><p>Rspec should be green</p><p>Automation should pass</p><p>PS: Might spillover</p></td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><h3 id="FreshsalesRailsMigration-GemUpgrade(3.2→4.0)">Gem Upgrade(3.2 → 4.0)</h3><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 99.2647%;"><colgroup><col style="width: 10.3039%;"/><col style="width: 6.52335%;"/><col style="width: 15.0482%;"/><col style="width: 11.9348%;"/><col style="width: 8.15419%;"/><col style="width: 48.0356%;"/></colgroup><tbody><tr><td style="text-align: center;" class="confluenceTd"><strong>Gem name</strong></td><td style="text-align: center;" class="confluenceTd"><strong>Current Version</strong></td><td style="text-align: center;" class="confluenceTd"><strong>4.0 Upgraded Version</strong></td><td class="confluenceTd"><strong>Upgrade/Mandatory Removal</strong></td><td colspan="1" class="confluenceTd">Ticket</td><td class="confluenceTd"><p><strong>Ticket/</strong><strong>Comments</strong></p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Rails</td><td style="text-align: center;" class="confluenceTd">3.2.22.5</td><td style="text-align: center;" class="confluenceTd">4.0.13</td><td style="text-align: center;" class="confluenceTd">5.0.0</td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Fd Multitenant</td><td style="text-align: center;" class="confluenceTd">freshsales org v2</td><td style="text-align: center;" class="confluenceTd">freshsales org v2 rails 4</td><td style="text-align: center;" class="confluenceTd">4.2</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15684" class="external-link" rel="nofollow">FSALES-15684</a> </td><td class="confluenceTd"><p>Only gemspec changes and gem upgrade. Need to Reverse merge with upstream branch</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Protected Attributes</td><td style="text-align: center;" class="confluenceTd">NA</td><td style="text-align: center;" class="confluenceTd">1.1.4</td><td style="text-align: center;" class="confluenceTd">5.0.0</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15681" class="external-link" rel="nofollow">FSALES-15681</a></td><td class="confluenceTd"><p>Added for attr_accessor support. Should be removed before rails 5.0</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Celluloid</td><td style="text-align: center;" class="confluenceTd">NA</td><td style="text-align: center;" class="confluenceTd">0.16.0</td><td style="text-align: center;" class="confluenceTd">Should be removed</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15682" class="external-link" rel="nofollow">FSALES-15682</a></td><td class="confluenceTd"><p>Celluloid was used by our central code base. Which was added as a dependency by sidekiq. Now sidekiq removed in recent version. Readded again for central codebase from our end.</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Activeresource</td><td style="text-align: center;" class="confluenceTd">NA</td><td style="text-align: center;" class="confluenceTd">With out lock</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Activerecord deprecated finders</td><td style="text-align: center;" class="confluenceTd">NA</td><td style="text-align: center;" class="confluenceTd">With out lock</td><td style="text-align: center;" class="confluenceTd">5.0.0(3.2)</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15683" class="external-link" rel="nofollow">FSALES-15683</a></td><td class="confluenceTd"><p>For providing support for find_by_* Need to do remove this gem before 5.0</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Freshdesk authority</td><td style="text-align: center;" class="confluenceTd">freshsales</td><td style="text-align: center;" class="confluenceTd">freshsales rails 4</td><td style="text-align: center;" class="confluenceTd">5.0.0</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15684" class="external-link" rel="nofollow">FSALES-15684</a></td><td class="confluenceTd"><p>No change need to Need to Reverse merge with upstream branch</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Central publisher</td><td style="text-align: center;" class="confluenceTd">freshsales v2</td><td style="text-align: center;" class="confluenceTd">freshsales v2 rails 4</td><td style="text-align: center;" class="confluenceTd">5.0.0</td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><p>Reverse merged and made changes</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Redis</td><td style="text-align: center;" class="confluenceTd">3.2.1</td><td style="text-align: center;" class="confluenceTd">3.3.1</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Sidekiq</td><td style="text-align: center;" class="confluenceTd">3.4.2</td><td style="text-align: center;" class="confluenceTd">4.2.10</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Will filter</td><td style="text-align: center;" class="confluenceTd">3.1.11</td><td style="text-align: center;" class="confluenceTd">git: '<a href="https://github.com/berk/will" class="external-link" rel="nofollow">https://github.com/berk/will</a> filter', branch: 'rails 4.1.x'</td><td style="text-align: center;" class="confluenceTd">4.2</td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Kaminari</td><td style="text-align: center;" class="confluenceTd">0.16.3</td><td style="text-align: center;" class="confluenceTd">0.17.0</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Nokogiri</td><td style="text-align: center;" class="confluenceTd">1.8.5</td><td style="text-align: center;" class="confluenceTd">1.10.5</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">bcrypt ruby</td><td style="text-align: center;" class="confluenceTd">NA</td><td style="text-align: center;" class="confluenceTd">3.1.2</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><p>Added as dependent gem, which was removed, readded this</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Faker</td><td style="text-align: center;" class="confluenceTd">Not locked</td><td style="text-align: center;" class="confluenceTd">1.6.3</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Shoulda</td><td style="text-align: center;" class="confluenceTd">Not locked</td><td style="text-align: center;" class="confluenceTd">3.5.0</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Freshid SDK</td><td style="text-align: center;" class="confluenceTd">1.0.0</td><td style="text-align: center;" class="confluenceTd">Added gemspec file path</td><td style="text-align: center;" class="confluenceTd">4.2</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15684" class="external-link" rel="nofollow">FSALES-15684</a></td><td class="confluenceTd"><p> Rails cant find gemspec</p></td></tr><tr><td style="text-align: center;" class="confluenceTd">Elasticsearch</td><td style="text-align: center;" class="confluenceTd">1.0.12</td><td style="text-align: center;" class="confluenceTd">1.0.18(Need to check)</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd">Need to find diff</td></tr><tr><td style="text-align: center;" class="confluenceTd">Dalli</td><td style="text-align: center;" class="confluenceTd">2.7.5</td><td style="text-align: center;" class="confluenceTd">2.7.10(Need to check)</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd">Need to find diff</td></tr><tr><td style="text-align: center;" class="confluenceTd">Active record shards</td><td style="text-align: center;" class="confluenceTd">3.1.0</td><td style="text-align: center;" class="confluenceTd">3.8.0</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Sass rails</td><td style="text-align: center;" class="confluenceTd">~&gt; 3.2.6</td><td style="text-align: center;" class="confluenceTd">5.0.7</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Coffee rails</td><td style="text-align: center;" class="confluenceTd">~&gt; 3.2.1</td><td style="text-align: center;" class="confluenceTd">4.2.2</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Turbo sprockets rails3</td><td style="text-align: center;" class="confluenceTd">0.3.14</td><td style="text-align: center;" class="confluenceTd">NA</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Uglifier</td><td style="text-align: center;" class="confluenceTd">&gt;= 1.0.3</td><td style="text-align: center;" class="confluenceTd">4.2.0</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Marginalia</td><td style="text-align: center;" class="confluenceTd">~&gt; 1.8</td><td style="text-align: center;" class="confluenceTd">1.8.0</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td style="text-align: center;" class="confluenceTd">Fluffy</td><td style="text-align: center;" class="confluenceTd">v0.0.4</td><td style="text-align: center;" class="confluenceTd">Commented for now</td><td style="text-align: center;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td class="confluenceTd"><p>Fluffy not providing support for 4.X</p></td></tr></tbody></table></div><h3 id="FreshsalesRailsMigration-Decision(3.2→4.0)">Decision (3.2 → 4.0)</h3><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 100.0%;"><colgroup><col style="width: 5.15085%;"/><col style="width: 20.3826%;"/><col style="width: 17.4393%;"/><col style="width: 8.0206%;"/><col style="width: 5.96026%;"/><col style="width: 7.35835%;"/><col style="width: 5.44518%;"/><col style="width: 5.51876%;"/><col style="width: 18.3959%;"/><col style="width: 6.32818%;"/></colgroup><tbody><tr><th class="confluenceTh">S.No </th><th class="confluenceTh">Description</th><th class="confluenceTh">Decision</th><th colspan="1" class="confluenceTh">Addressable version</th><th colspan="1" class="confluenceTh">Impact</th><th colspan="1" class="confluenceTh">Status</th><th colspan="1" class="confluenceTh">Added Version</th><th colspan="1" class="confluenceTh">Final  Version</th><th colspan="1" class="confluenceTh">Todo</th><th class="confluenceTh">Ticket</th></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd">association.delete is throwing an error when null is passed</td><td class="confluenceTd">Fixed in places where the error is thrown</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Medium</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td class="confluenceTd">NA</td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">Circular Dependency   in  LCAD  Serializer(Previously rails ignore circular dependencies, now it will throw an error)</td><td class="confluenceTd">Resolved by adding the related path in import</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Low/easy</td><td colspan="1" class="confluenceTd">Deployed</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td class="confluenceTd">NA</td></tr><tr><td class="confluenceTd">3</td><td class="confluenceTd">Rails added rails,bundle,rake in bin/ location</td><td class="confluenceTd">Added same here</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev compltete</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">ASAP</td><td colspan="1" class="confluenceTd">Need to move all scripts if any to the new location.</td><td class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15688" class="external-link" rel="nofollow">FSALES-15688</a></td></tr><tr><td colspan="1" class="confluenceTd">4</td><td colspan="1" class="confluenceTd"><span style="color: rgb(36,41,46);">Rails removed model name as  root element  in response</span></td><td colspan="1" class="confluenceTd">Added model name as root using config <span style="color: rgb(36,41,46);">include_root_in_json=true</span></td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev complete</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">5</td><td colspan="1" class="confluenceTd"><span style="color: rgb(36,41,46);">Throwing error for nil in development is removed. Hereafter it won't throw an error </span></td><td colspan="1" class="confluenceTd">Removed config</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev complete</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">6</td><td colspan="1" class="confluenceTd">Explain in development for the large query is removed</td><td colspan="1" class="confluenceTd">Removed config</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev complete</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">7</td><td colspan="1" class="confluenceTd">IdentityMap was removed</td><td colspan="1" class="confluenceTd">Removed realted code in patches. Since rails removed it no use of the code.</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Low</td><td colspan="1" class="confluenceTd">Deployed</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">8</td><td colspan="1" class="confluenceTd">transaction_include_action was replaced with transaction_include_any_action</td><td colspan="1" class="confluenceTd">Monkey patched to reduce reverse merge conflicts</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev complete</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">4.2</td><td colspan="1" class="confluenceTd">Need to change code to use transaction_include_any_action</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15690" class="external-link" rel="nofollow">FSALES-15690</a></td></tr><tr><td colspan="1" class="confluenceTd">9</td><td colspan="1" class="confluenceTd">Rails added millisecond precision as default caused multiple issues including ES</td><td colspan="1" class="confluenceTd">Monkey patched</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev complete</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">4.1</td><td colspan="1" class="confluenceTd">in 4.1 config was added for this</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15691" class="external-link" rel="nofollow">FSALES-15691</a></td></tr><tr><td colspan="1" class="confluenceTd">10</td><td colspan="1" class="confluenceTd"><span style="color: rgb(36,41,46);">match was removed</span></td><td colspan="1" class="confluenceTd">Converted to get,post</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Low</td><td colspan="1" class="confluenceTd">Deployed</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">11</td><td colspan="1" class="confluenceTd">Active record relation return object instead of array of AR. This causes the issue in the pluck of relation(Which was cached), Typeof check. </td><td colspan="1" class="confluenceTd">We cannot convert it back to Array because this will result in loss of efficiency on new rails. So fixed in places it broke</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">In progress</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">12</td><td colspan="1" class="confluenceTd"><p><span style="color: rgb(36,41,46);">where_values was changed. Which was used to OR query construction or manual  query construction. </span></p><p><span style="color: rgb(36,41,46);">where_values is an internal implementation</span></p></td><td colspan="1" class="confluenceTd">Converted it String-based query. It is in 2 places only</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Deployed</td><td colspan="1" class="confluenceTd">Deployed</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">13</td><td colspan="1" class="confluenceTd">AR caches relationship. Previously for .all methods, it used to go for the direct SQL query. Now AR caches relation. </td><td colspan="1" class="confluenceTd"><p>Need to analyse the inverse of relation in all models. </p></td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">HIGH</td><td colspan="1" class="confluenceTd">Yet to start</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td><td colspan="1" class="confluenceTd">NA</td></tr><tr><td colspan="1" class="confluenceTd">14</td><td colspan="1" class="confluenceTd">find_by_* and dynamic fetcher was removed</td><td colspan="1" class="confluenceTd">Added back functionality by adding ActiveRecord deprecated finders gem. </td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">HIGH</td><td colspan="1" class="confluenceTd">after 4.2*</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">5.0</td><td colspan="1" class="confluenceTd">Need to refactor all related code</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15683" class="external-link" rel="nofollow">FSALES-15683</a></td></tr><tr><td colspan="1" class="confluenceTd">15 </td><td colspan="1" class="confluenceTd"><pre><span style="letter-spacing: 0.0px;">attr_accessible was removed. </span></pre></td><td colspan="1" class="confluenceTd">Added back functionality by adding gem</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">VERY HIGH</td><td colspan="1" class="confluenceTd">Yet to start</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">5.0</td><td colspan="1" class="confluenceTd">Need to refactor all related code</td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15681" class="external-link" rel="nofollow">FSALES-15681</a></td></tr><tr><td colspan="1" class="confluenceTd">16</td><td colspan="1" class="confluenceTd">Cache issues. Memcache and redis contains the serialised data of AR, caused multiple issues and errors</td><td colspan="1" class="confluenceTd">Fixed by changing numbers</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">HIGH</td><td colspan="1" class="confluenceTd">In progress</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">ASAP</td><td colspan="1" class="confluenceTd">Need to have only Ids in Caches</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">17</td><td colspan="1" class="confluenceTd"><span style="color: rgb(34,34,34);">SQL mode is made as strict, causing multiple breakage in code</span></td><td colspan="1" class="confluenceTd">Fixed by disabling the strict mode</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">High</td><td colspan="1" class="confluenceTd">after 4.2*</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd">ASAP</td><td colspan="1" class="confluenceTd">Need to fix all those cases.<br/><p class="p1">Need to add strict in staging</p></td><td colspan="1" class="confluenceTd"><a href="https://freshworks.freshrelease.com/FSALES/issues/FSALES-15713" class="external-link" rel="nofollow">FSALES-15713</a></td></tr><tr><td colspan="1" class="confluenceTd">18</td><td colspan="1" class="confluenceTd">Need to add inverse for rails through relationship</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">In review</td><td colspan="1" class="confluenceTd">Yet to start</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">19</td><td colspan="1" class="confluenceTd">Random assignment of the variable in the model is restricted</td><td colspan="1" class="confluenceTd">We should restrict it(Need to identify all impact areas)`</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Need to check</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">20</td><td colspan="1" class="confluenceTd">time.now.to_f won't return full precision as float. rounded to zero </td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">Dev complete</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">21</td><td colspan="1" class="confluenceTd">Includes(nil)  will throw error</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Low</td><td colspan="1" class="confluenceTd">Inprogress</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">22</td><td colspan="1" class="confluenceTd"><p>Validates using _id is wrong. </p><p>Presence of should be done </p></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Medium</td><td colspan="1" class="confluenceTd">Yet to start</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">23</td><td colspan="1" class="confluenceTd">Direct accessing and changing the Varaibles in model is restricted(with out select)</td><td colspan="1" class="confluenceTd">Need to fix this</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">HIGH</td><td colspan="1" class="confluenceTd">In progress</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">24</td><td colspan="1" class="confluenceTd">Default scope without function is not allowed</td><td colspan="1" class="confluenceTd">Need to fix this</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Low</td><td colspan="1" class="confluenceTd">Yet to start</td><td colspan="1" class="confluenceTd">4.1</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><a href="https://guides.rubyonrails.org/4_1_release_notes.html" class="external-link" rel="nofollow">https://guides.rubyonrails.org/4_1_release_notes.html</a></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">25</td><td colspan="1" class="confluenceTd">Default scope is added in joins</td><td colspan="1" class="confluenceTd">Need to check and fix in few places</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">High</td><td colspan="1" class="confluenceTd">in progress</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">26</td><td colspan="1" class="confluenceTd">Internal Gem can be upgraded </td><td colspan="1" class="confluenceTd">fd_multitenant,fd_subscription,freshdesk_authority,freshsales-analytics,freshdesk_features,record_not_unique,rate-limiting,freshcaller,central-publisher,freshid,rule_engine,memoize_until,fluffy</td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd">Very High</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">27</td><td colspan="1" class="confluenceTd">Rails active record migrations now mandates the params</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">28</td><td colspan="1" class="confluenceTd">Datetime Comparision in rails Is wrong since rails made DateTime as millisecond precision by default</td><td colspan="1" class="confluenceTd">Changed the spec alone. Since there won't be any exact match for the date</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">29</td><td colspan="1" class="confluenceTd">build_modal automatically gets associated</td><td colspan="1" class="confluenceTd">Changed in one place</td><td colspan="1" class="confluenceTd">4.0</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">30</td><td colspan="1" class="confluenceTd">ActiveSupport::Base64 was removed and replacted with Base64</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd">3.2</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">31</td><td colspan="1" class="confluenceTd">_was priviously returned empty hash not returning nil</td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><h3 id="FreshsalesRailsMigration-Learnings">Learnings</h3><ul><li><a href="https://docs.google.com/document/d/1gr4p_FpJcM9poIytuoelsCDYFZbQVaBtS25Sk1y_mP0/edit?usp=sharing" class="external-link" rel="nofollow">4.0.13</a></li></ul>