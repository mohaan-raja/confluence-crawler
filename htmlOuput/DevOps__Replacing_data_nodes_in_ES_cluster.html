<h1>Title: DevOps: Replacing data nodes in ES cluster</h1><p>1. Change the cluster settings as follows.</p><p>  curl -XPUT &quot;<a href="http://localhost:9200/_cluster/settings" class="external-link" rel="nofollow">http://localhost:9200/_cluster/settings</a>&quot; -d'<br/>  {<br/>     &quot;persistent&quot;: {<br/>       &quot;indices.recovery.max_bytes_per_sec&quot;: &quot;750mb&quot;<br/>     },<br/>     &quot;transient&quot; : {<br/>       &quot;cluster.routing.allocation.cluster_concurrent_rebalance&quot; : 1,<br/>       &quot;cluster.routing.allocation.disable_allocation&quot; : true<br/>     }<br/>  }'</p><p>2. Boot all the new data instances and wait for the nodes to join the cluster.</p><p>  curl -XGET localhost:9200/_cat/nodes?v</p><p>3. Now enable the shard relocation.</p><p>  curl -XPUT &quot;<a href="http://localhost:9200/_cluster/settings" class="external-link" rel="nofollow">http://localhost:9200/_cluster/settings</a>&quot; -d'<br/>  {<br/>     &quot;transient&quot; : {<br/>       &quot;cluster.routing.allocation.disable_allocation&quot; : false<br/>     }<br/>  }'</p><p>4. Wait for shards to be rebalanced across the data nodes.</p><p>  curl -XGET localhost:9200/_cat/allocation?v<br/>  curl -XGET localhost:9200/_cat/health?v<br/>  curl -XGET localhost:9200/_cat/shards?v</p><p>5. Once rebalancing is done, ssh into one old data node to be removed.<br/>   a. Comment the contents of /etc/monit.d/elasticsearch.monitrc<br/>   b. Reload monit config : monit reload</p><p>6. Remove the data node from the cluster.</p><p>  curl -XPOST <a rel="nofollow">http://localhost:9200/_cluster/nodes/&lt;node_name&gt;/_shutdown</a><br/>  node_name value can be found in the 'host' column of the result of curl -XGET localhost:9200/_cat/nodes?v</p><p>7. Wait for shards to be rebalanced across the data nodes.</p><p>  curl -XGET localhost:9200/_cat/allocation?v<br/>  curl -XGET localhost:9200/_cat/health?v<br/>  curl -XGET localhost:9200/_cat/shards?v</p><p>8. Repeat steps 5 - 7 for all the data nodes to be removed from the cluster one by one.</p><p>9. Once all old data nodes are removed, then change the cluster setting to default.</p><p>  curl -XPUT &quot;<a href="http://localhost:9200/_cluster/settings" class="external-link" rel="nofollow">http://localhost:9200/_cluster/settings</a>&quot; -d'<br/>  {<br/>     &quot;persistent&quot;: {<br/>       &quot;indices.recovery.max_bytes_per_sec&quot;: &quot;40mb&quot;<br/>     },<br/>     &quot;transient&quot; : {<br/>       &quot;cluster.routing.allocation.cluster_concurrent_rebalance&quot; : 2<br/>     }<br/>  }'</p><p><br/></p>