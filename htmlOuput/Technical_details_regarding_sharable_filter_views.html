<h1>Title: Technical details regarding sharable filter views</h1><p><strong>Intro: </strong></p><p>Building more sharing options for filter views where user can share to specific set of users based on his choice.</p><p>more information regarding the spec is mentioned in the below Jira</p><p><strong>Jira: <a class="external-link" style="text-align: left;" href="https://www.google.com/url?q=http://jira.freshworks.com/browse/FSALES-2500&amp;sa=D&amp;ust=1519113009757000&amp;usg=AFQjCNEXtjwske-9w6XAR3gi02blQaZ5gw" rel="nofollow">http://jira.freshworks.com/browse/FSALES-2500</a></strong></p><p><strong><br/>Database schema:</strong></p><p><strong>Permission Table:</strong></p><p>Permission table has permission_id and scope(Integer) as fields where as scope can be private/public/Selected users/territories.</p><p>Using this table makes public and private scope easily accessible as we can avoid another query to the table 'Sharable view resolver' and also it reduces the entries into 'sharable view resolver' table as it is normalised. </p><p>0- private</p><p>1- public</p><p>2- users</p><p><br/></p><p><strong>permission_scopes(new table <strong><strong>addition</strong></strong>)</strong></p><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">id</th><th class="confluenceTh">permission_id</th><th class="confluenceTh">scope</th><th class="confluenceTh">account_id</th></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd">12</td><td class="confluenceTd">2</td><td class="confluenceTd">1</td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">15</td><td class="confluenceTd">1</td><td class="confluenceTd">1</td></tr><tr><td class="confluenceTd">3</td><td class="confluenceTd">15</td><td class="confluenceTd">2</td><td class="confluenceTd">1</td></tr></tbody></table></div><p><br/></p><p><strong>Sharable View resolver Table:</strong></p><p>This table has entity_name(Eg: 'filter_view', 'report_view'), entity_id( id of that particular view in that entity ), permission_id( id of the particular scope ), access_id( this has the IDs of a particular scope ), account_id</p><p>Using this table makes it scalable as we can bring in roles and it will also be scalable if we bring sharable views to customer reports, email templates.</p><p><br/></p><p><strong>permission_details(<strong>new table addition)</strong></strong></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col style="width: 37.0px;"/><col style="width: 103.0px;"/><col style="width: 79.0px;"/><col style="width: 116.0px;"/><col style="width: 88.0px;"/><col style="width: 95.0px;"/></colgroup><tbody><tr><th class="confluenceTh">ID</th><th class="confluenceTh">entity_name</th><th class="confluenceTh">entity_id</th><th class="confluenceTh">permission_id</th><th class="confluenceTh">object_id</th><th class="confluenceTh">account_id</th></tr><tr><td class="confluenceTd">23</td><td class="confluenceTd">LeadCustomFilter</td><td class="confluenceTd">2</td><td class="confluenceTd">12</td><td class="confluenceTd">2</td><td class="confluenceTd">1</td></tr><tr><td class="confluenceTd">24</td><td class="confluenceTd">CustomReport</td><td class="confluenceTd">3</td><td class="confluenceTd">15</td><td class="confluenceTd">1</td><td class="confluenceTd">1</td></tr><tr><td class="confluenceTd">25</td><td class="confluenceTd">CustomReport</td><td class="confluenceTd">3</td><td class="confluenceTd">15</td><td class="confluenceTd">2</td><td class="confluenceTd">1</td></tr></tbody></table></div><p><br/></p><p><strong>object_id ?</strong></p><p>→ if the scope is user then object id will be user id and if scope is territory object id will be territory_id and similarly for roles it will be role id</p><p><br/></p><p><strong>Adding column to Filters/reports..:</strong><br/>will_filter_filters/custom_reports(or any other table) to use sharable views to any new entity we have to add a permission_id column and will be removing is_public.</p><p><br/></p><p><strong>will_filter_filters(new column addition: permission_id)</strong></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><tbody><tr><th class="confluenceTh">ID</th><th class="confluenceTh">account_id</th><th class="confluenceTh">name</th><th class="confluenceTh">model_class_name</th><th class="confluenceTh">data</th><th class="confluenceTh">user_id</th><th class="confluenceTh">is_default</th><th class="confluenceTh">type</th><th class="confluenceTh">created_at</th><th class="confluenceTh">updated_at</th><th class="confluenceTh">permission_id</th></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd">1</td><td class="confluenceTd">My Leads</td><td class="confluenceTd">Lead</td><td class="confluenceTd">hash</td><td class="confluenceTd">-1</td><td class="confluenceTd">1</td><td class="confluenceTd">LeadCustomFilter</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd">12</td></tr><tr><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr></tbody></table></div><p><strong>SQL Queries:</strong></p><p><strong>For Selected Users:</strong></p><ol><li>Select * from will_filter_filters where account_id = current_account.id</li><li>Select scope from permission_access where permission_access_id = permission_id</li><li>Select * from from sharable_view_resolver where account_id = current_account.id and entity_name = '?' and entity_id = ? and permission_id=? and access_id = current_user.id</li><li><strong>For Private and Public scope can be resolved using first two queries.</strong></li></ol><p style="text-align: center;"><br/></p><p><br/></p><p><br/></p>